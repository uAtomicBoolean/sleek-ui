import {
    UMainColorsStyle,
    UBackgroundColorsStyle,
    UFillColorsStyle,
    UShadowStyle,
    UFocusStyle,
    UTextStyle,
    UFontSizeStyle,
    UBorderStyle,
    UPaddingStyle,
    USpacingStyle,
    URadiusStyle,
} from "structs/styles.slint";
import { UDefaultStyle } from "styling/default-style.slint";
import { Palette } from "std-widgets.slint";
import {
    UThemeColors,
    USingleColor,
    UVariantsColor,
    UColorSchemeVariantsColor,
} from "structs/colors.slint";

import { UThemeConfig } from "theme-config.slint";

export enum UColorScheme {
	light,
	dark,
	system,
}

export global UAppTheme {
    in-out property <float> scale-factor: 1;
    in-out property <duration> animation-duration: 150ms;
    in-out property <UColorScheme> color-scheme: system;

    // Color scheme management.
    pure function get-themed-color(light: brush, dark: brush) -> brush {
        if color-scheme == UColorScheme.light {
            return light;
        } else if color-scheme == UColorScheme.dark {
            return dark;
        }
        return Palette.color-scheme == ColorScheme.dark ? dark : light;
    }
    pure function get-variants-color(light: UVariantsColor, dark: UVariantsColor) -> UVariantsColor {
        if color-scheme == UColorScheme.light {
            return light;
        } else if color-scheme == UColorScheme.dark {
            return dark;
        }
        return Palette.color-scheme == ColorScheme.dark ? dark : light;
    }

    // Main colors
    out property <UVariantsColor> primary: get-variants-color(light.primary, dark.primary);
    out property <UVariantsColor> success: get-variants-color(light.success, dark.success);
    out property <UVariantsColor> warning: get-variants-color(light.warning, dark.warning);
    out property <UVariantsColor> danger: get-variants-color(light.danger, dark.danger);

    // Background colors
    out property <brush> bg-layout: get-themed-color(light.bg-layout, dark.bg-layout);
    out property <brush> bg-container: get-themed-color(light.bg-container, dark.bg-container);
    out property <brush> bg-elevated: get-themed-color(light.bg-elevated, dark.bg-elevated);
    out property <brush> bg-inverse: get-themed-color(light.bg-inverse, dark.bg-inverse);

    // Fill colors
    out property <brush> color-fill-plus: get-themed-color(light.color-fill-plus, dark.color-fill-plus);
    out property <brush> color-fill: get-themed-color(light.color-fill, dark.color-fill);
    out property <brush> color-fill-secondary: get-themed-color(light.color-fill-secondary, dark.color-fill-secondary);
    out property <brush> color-fill-tertiary: get-themed-color(light.color-fill-tertiary, dark.color-fill-tertiary);
    out property <brush> color-fill-quaternary: get-themed-color(light.color-fill-quaternary, dark.color-fill-quaternary);

    // Borders
    out property <length> border-width-base: UThemeConfig.border-style.width * scale-factor;
    out property <brush> border: get-themed-color(light.border, dark.border);
    out property <brush> border-secondary: get-themed-color(light.border-secondary, dark.border-secondary);
    out property <brush> separator: get-themed-color(light.separator, dark.separator);

    // Shadow
    out property <brush> shadow-color: get-themed-color(light.shadow-color, dark.shadow-color);
    out property <length> shadow-blur: UThemeConfig.shadow-style.blur * scale-factor;
    out property <length> shadow-x-offset: UThemeConfig.shadow-style.x-offset * scale-factor;
    out property <length> shadow-y-offset: UThemeConfig.shadow-style.y-offset * scale-factor;

    // Focus display
    out property <brush> focus-color: get-themed-color(light.focus-color, dark.focus-color);
    out property <length> focus-border-width: UThemeConfig.focus-style.border-width * scale-factor;

    // Text colors
    out property <brush> inverse-text: get-themed-color(light.inverse-text, dark.inverse-text);
    out property <brush> text: get-themed-color(light.text, dark.text);
    out property <brush> text-secondary: get-themed-color(light.text-secondary, dark.text-secondary);
    out property <brush> text-heading: get-themed-color(light.text-heading, dark.text-heading);
    out property <brush> text-disabled: get-themed-color(light.text-disabled, dark.text-disabled);

    // Font sizes
    out property <length> font-size-smaller: UThemeConfig.font-size-style.smaller * scale-factor;
    out property <length> font-size-small: UThemeConfig.font-size-style.small * scale-factor;
    out property <length> font-size-base: UThemeConfig.font-size-style.base * scale-factor;
    out property <length> font-size-medium: UThemeConfig.font-size-style.medium * scale-factor;
    out property <length> font-size-big: UThemeConfig.font-size-style.big * scale-factor;
    out property <length> font-size-bigger: UThemeConfig.font-size-style.bigger * scale-factor;
	
    // Icons
    out property <length> icon-size-base: UThemeConfig.font-size-style.icon-base-size * scale-factor;

    // Padding
    out property <length> padding-vertical: UThemeConfig.padding-style.vertical * scale-factor;
    out property <length> padding-horizontal: UThemeConfig.padding-style.horizontal * scale-factor;
    out property <length> padding-small: UThemeConfig.padding-style.small * scale-factor;
    out property <length> padding-base: UThemeConfig.padding-style.base * scale-factor;
    out property <length> padding-medium: UThemeConfig.padding-style.medium * scale-factor;
    out property <length> padding-big: UThemeConfig.padding-style.big * scale-factor;
    out property <length> padding-bigger: UThemeConfig.padding-style.bigger * scale-factor;

    // Spacing
    out property <length> spacing-small: UThemeConfig.spacing-style.small * scale-factor;
    out property <length> spacing-base: UThemeConfig.spacing-style.base * scale-factor;
    out property <length> spacing-medium: UThemeConfig.spacing-style.medium * scale-factor;
    out property <length> spacing-big: UThemeConfig.spacing-style.big * scale-factor;
    out property <length> spacing-bigger: UThemeConfig.spacing-style.bigger * scale-factor;

    // Radius
    out property <length> radius-small: UThemeConfig.radius-style.small * scale-factor;
    out property <length> radius-base: UThemeConfig.radius-style.base * scale-factor;
    out property <length> radius-medium: UThemeConfig.radius-style.medium * scale-factor;
    out property <length> radius-large: UThemeConfig.radius-style.large * scale-factor;
    out property <length> radius-round: UThemeConfig.radius-style.round * scale-factor;
    out property <length> radius-circle: UThemeConfig.radius-style.circle;

	// Structs with both color scheme mode for the colors.
	out property <UThemeColors> light: {
		// Main colors
    	primary: UThemeConfig.primary-color-style.light,
        success: UThemeConfig.success-color-style.light,
        warning: UThemeConfig.warning-color-style.light,
        danger: UThemeConfig.danger-color-style.light,

    	// Background colors
    	bg-layout: UThemeConfig.background-colors-style.layout.light,
        bg-container: UThemeConfig.background-colors-style.container.light,
        bg-elevated: UThemeConfig.background-colors-style.elevated.light,
        bg-inverse: UThemeConfig.background-colors-style.inverse.light,

    	// Fill colors
    	color-fill-plus: UThemeConfig.fill-colors-style.fill-plus.light,
        color-fill: UThemeConfig.fill-colors-style.fill.light,
        color-fill-secondary: UThemeConfig.fill-colors-style.fill-secondary.light,
        color-fill-tertiary: UThemeConfig.fill-colors-style.fill-tertiary.light,
        color-fill-quaternary: UThemeConfig.fill-colors-style.fill-quaternary.light,
	
    	// Borders
    	border: UThemeConfig.border-style.color.light,
        border-secondary: UThemeConfig.border-style.color-secondary.light,
        separator: UThemeConfig.border-style.separator.light,

    	// Shadow
    	shadow-color: UThemeConfig.shadow-style.color.light,

    	// Focus display
    	focus-color: UThemeConfig.focus-style.color.light,

    	// Text colors
    	inverse-text: UThemeConfig.text-style.color-inverse.light,
        text: UThemeConfig.text-style.color.light,
        text-secondary: UThemeConfig.text-style.color-secondary.light,
        text-heading: UThemeConfig.text-style.color-heading.light,
        text-disabled: UThemeConfig.text-style.color-disabled.light,
    };
    out property <UThemeColors> dark: {
		// Main colors
    	primary: UThemeConfig.primary-color-style.light,
        success: UThemeConfig.success-color-style.light,
        warning: UThemeConfig.warning-color-style.light,
        danger: UThemeConfig.danger-color-style.light,

    	// Background colors
    	bg-layout: UThemeConfig.background-colors-style.layout.light,
        bg-container: UThemeConfig.background-colors-style.container.light,
        bg-elevated: UThemeConfig.background-colors-style.elevated.light,
        bg-inverse: UThemeConfig.background-colors-style.inverse.light,

    	// Fill colors
    	color-fill-plus: UThemeConfig.fill-colors-style.fill-plus.light,
        color-fill: UThemeConfig.fill-colors-style.fill.light,
        color-fill-secondary: UThemeConfig.fill-colors-style.fill-secondary.light,
        color-fill-tertiary: UThemeConfig.fill-colors-style.fill-tertiary.light,
        color-fill-quaternary: UThemeConfig.fill-colors-style.fill-quaternary.light,
	
    	// Borders
    	border: UThemeConfig.border-style.color.light,
        border-secondary: UThemeConfig.border-style.color-secondary.light,
        separator: UThemeConfig.border-style.separator.light,

    	// Shadow
    	shadow-color: UThemeConfig.shadow-style.color.light,

    	// Focus display
    	focus-color: UThemeConfig.focus-style.color.light,

    	// Text colors
    	inverse-text: UThemeConfig.text-style.color-inverse.light,
        text: UThemeConfig.text-style.color.light,
        text-secondary: UThemeConfig.text-style.color-secondary.light,
        text-heading: UThemeConfig.text-style.color-heading.light,
        text-disabled: UThemeConfig.text-style.color-disabled.light,
    };
}
