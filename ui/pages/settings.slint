import { UAppTheme } from "../sleek-ui/app-theme.slint";
import { UPrimaryColor } from "../sleek-ui/structs/theme.slint";
import {
    UDivider,
    UTitle,
    UText,
    USlider,
    UScrollView,
    ButtonInterface,
} from "../sleek-ui/widgets.slint";

import { DocTitle, DocSection, DocCode } from "../components/doc-widgets.slint";
import { PageBase } from "../components/page-base.slint";
import { AppLogic } from "../app-logic.slint";


component ColorDisplay inherits Rectangle {
    in-out property <string> name;
    in-out property <UPrimaryColor> theme-color;
    VerticalLayout {
        padding: UAppTheme.padding-base;
        padding-bottom: 0;
        spacing: UAppTheme.spacing-base;
        Rectangle {
            HorizontalLayout {
                spacing: UAppTheme.spacing-big;
                Rectangle {
                    width: 40px;
                    height: 30px;
                    background: theme-color.base;
                    border-radius: UAppTheme.radius-base;
                    border-width: UAppTheme.border-width-base;
                    border-color: UAppTheme.border;
                }

                VerticalLayout {
                    alignment: center;
                    color-name := UText {
                        text: name;
                        animate color { duration: UAppTheme.animation-duration; }
                    }
                }
            }

            touch := ButtonInterface {
                clicked => {
                    UAppTheme.light.primary = theme-color;
                    UAppTheme.dark.primary = theme-color;
                }
            }

            states [
                pressed when touch.pressed: {
                    color-name.color: theme-color.base;
                    background: theme-color.selected;
                }
                hover when touch.has-hover: {
                    background: theme-color.selected;
                }
            ]
        }

        HorizontalLayout {
            alignment: center;
            UDivider {
                width: 580px;
            }
        }
    }
}

component CompleteSlider inherits VerticalLayout {
    in-out property <float> value <=> slider.value;
    in-out property <float> min-value;
    in-out property <float> max-value;
    in-out property <float> step;
    in-out property <string> value-suffix;
    callback released <=> slider.released;
    HorizontalLayout {
        alignment: start;
        spacing: UAppTheme.spacing-big;
        padding-top: UAppTheme.padding-big;
        text-left := UText {
            text: "\{min-value}\{value-suffix}";
            font-weight: 600;
        }

        VerticalLayout {
            alignment: center;
            slider := USlider {
                width: 300px;
                min-value: root.min-value;
                max-value: root.max-value;
                step: step;
                display-steps: true;
            }
        }

        UText {
            text: "\{max-value}\{value-suffix}";
            font-weight: 600;
        }
    }

    HorizontalLayout {
        alignment: start;
        padding-top: UAppTheme.padding-base;
        VerticalLayout {
            Text {
                x: text-left.width + slider.handle-pos;
                text: "\{value}\{value-suffix}";
                font-weight: 600;
            }
        }
    }
}

export component SettingsPage inherits PageBase {
    private property <[{ name: string, color: UPrimaryColor}]> colors: [
        { name: "Dust red", color: UAppTheme.dust-red },
        { name: "Volcano", color: UAppTheme.volcano },
        { name: "Sunset orange", color: UAppTheme.sunset-orange },
        { name: "Calendula gold", color: UAppTheme.calendula-gold },
        { name: "Sunrise yellow", color: UAppTheme.sunrise-yellow },
        { name: "Lime", color: UAppTheme.lime },
        { name: "Polar green", color: UAppTheme.polar-green },
        { name: "Cyan", color: UAppTheme.cyan },
        { name: "Daybreak blue", color: UAppTheme.daybreak-blue },
        { name: "Geek blue", color: UAppTheme.geek-blue },
        { name: "Golden purple", color: UAppTheme.golden-purple },
        { name: "French magenta", color: UAppTheme.french-magenta },
    ];
    UTitle {
        level: 3;
        text: "Settings";
    }

    DocSection {
        title: "Primary color";
        description: [[{ text: "Change the current primary color." }]];
    }

    HorizontalLayout {
        alignment: start;
        padding-top: UAppTheme.padding-base;
        UScrollView {
            height: 200px;
            width: 600px;
            border-width: UAppTheme.border-width-base;
            border-color: UAppTheme.border;
            border-radius: UAppTheme.radius-base;
            VerticalLayout {
                for color[idx] in colors: ColorDisplay {
                    name: color.name;
                    theme-color: color.color;
                }
            }
        }
    }

    if !AppLogic.is-wasm(): DocSection {
        title: "Scale factor";
        description: [
            [
                { text: "Change the application's scale factor using the slint's scale factor." }
            ]
        ];
    }
    if !AppLogic.is-wasm(): CompleteSlider {
        min-value: 50;
        max-value: 200;
        step: 25;
        value <=> AppLogic.scale-factor;
        value-suffix: "%";
        released(value) => {
            AppLogic.update-scale-factor(value);
        }
    }
    DocSection {
        title: "Base radius";
        description: [
            [
                { text: "Change the application's scale factor using the slint's scale factor." }
            ],
            [
                {
                    text: "Please note that some widgets are clamped to a maximum border radius (4px)."
                }
            ],
            [
                { text: "This avoid having weird looking widgets (UCard, UModal, UTooltip, etc)." }
            ]
        ];
    }

    CompleteSlider {
        min-value: 0;
        max-value: 20;
        value: UAppTheme.radius-base / 1px;
        step: 2;
        value-suffix: "px";
        released(value) => {
            UAppTheme.light.radius-base = value * 1px;
            UAppTheme.dark.radius-base = value * 1px;
        }
    }
}
